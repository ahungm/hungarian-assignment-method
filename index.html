<!DOCTYPE html>
<html>
  <head>
    <title>Método Húngaro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div
      id="main"
      style="
        background-color: 152642;
        padding-left: 50px;
        margin-top: 10px;
        padding-top: 20px;
        margin-bottom: 50px;
        padding-bottom: 20px;
      "
    >
      <div>
        <h1>Modelo de Asignación - Método Húngaro</h1>
        <br />
      </div>
      <div>
        <label>Seleccione el tipo de problema: </label>
        <select id="problemType">
          <option value="min" selected="selected">Minimización (MIN)</option>
          <option value="max">Maximización (MAX)</option></select
        ><br /><br />

        <label class="note"
          >Observación : Para indicar un valor restringido, simplemente inserte
          <b>"M"</b> en la posición correspondiente.</label
        ><br /><br />

        <label>Número de filas : </label>
        <input type="number" id="rows" min="1" /><br /><br />

        <label>Número de columnas : </label>
        <input type="number" id="cols" min="1" /><br /><br />

        <input
          type="button"
          id="display_matrix"
          value="Generar Matriz para ingresar datos"
        /><br /><br />
      </div>
      <div id="dataMatrix"></div>
      <br />

      <div id="resultBtn" style="display: none">
        <input type="button" id="getResult" value="Obtener resultado" />
      </div>

      <div id="result"></div>
      <br /><br />

      <div id="doAnother" style="display: none; text-align: center">
        <input type="button" id="anotherQue" value="Resolver otro problema" />
        <input type="button" id="printAns" value="Imprimir Respuesta" />
      </div>

      <script>
        // Base Script
        $(document).ready(function () {
          $("#display_matrix").click(function () {
            rows = parseInt($("#rows").val());
            cols = parseInt($("#cols").val());

            if (rows < cols) {
              matrixLength = rows;
              dummy = "row";
            } else {
              matrixLength = cols;
              dummy = "col";
            }

            var k = 0;
            var genTable;
            genTable = "<table id='table1'>";
            $("#dataMatrix").html(genTable);
            for (var i = 0; i < rows + 1; i++) {
              genTable = '<tr id="row' + i + '"></tr>';
              $("#dataMatrix").append(genTable);
              for (var j = 0; j < cols + 1; j++) {
                if (i == 0 && j == 0) {
                  genTable = "<td> Fila\\Columna </td>";
                } else if (i == 0) {
                  genTable = "<td>" + j + "</td>";
                } else if (j == 0) {
                  genTable = "<td>" + i + "</td>";
                } else {
                  genTable =
                    '<td id="col' +
                    k +
                    '"><input class="inTable" type="text" id="data' +
                    k +
                    '"></input></td>';
                  k++;
                }

                $("#row" + i).append(genTable);
              }
            }
            genTable = "</table>";
            $("#dataMatrix").append(genTable);

            $("#resultBtn").css("display", "inline-block");
          });

          $("#getResult").click(function () {
            cntModified = 1;
            block = (rows * cols) / matrixLength;

            data = new Array(block);
            for (var i = 0; i < block; i++) {
              data[i] = new Array(block);
            }

            var k = 0;
            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                if (dummy == "col") {
                  if (j > cols - 1) {
                    data[i][j] = 0;
                  } else {
                    if ($("#data" + k).val() == "M") {
                      data[i][j] = 10000000;
                    } else {
                      if ($("#data" + k).val() == "") {
                        data[i][j] = 0;
                      } else {
                        data[i][j] = $("#data" + k).val();
                      }
                    }
                    k++;
                  }
                } else if (dummy == "row") {
                  if ($("#data" + k).val() == null) {
                    data[i][j] = 0;
                  } else {
                    if ($("#data" + k).val() == "M") {
                      data[i][j] = 10000000;
                    } else {
                      if ($("#data" + k).val() == "") {
                        data[i][j] = 0;
                      } else {
                        data[i][j] = $("#data" + k).val();
                      }
                    }
                    k++;
                  }
                }
              }
            }

            originalData = new Array(block);
            for (var i = 0; i < block; i++) {
              originalData[i] = new Array(block);
            }

            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                originalData[i][j] = data[i][j];
              }
            }

            $("#result").html(
              "<br/><b>La matriz proporcionada y balanceada es :</b> <br/><br/>"
            );

            var table = '<table id="table2">';

            $("#result").append(table);
            for (var i = 0; i < block; i++) {
              table = '<tr id="row2' + i + '"></tr>';
              $("#result").append(table);
              for (var j = 0; j < block; j++) {
                var printValue;
                if (data[i][j] > 10000000) {
                  printValue = "M";
                  table = "<td>" + printValue + "</td>";
                } else {
                  table = "<td>" + data[i][j] + "</td>";
                }
                $("#row2" + i).append(table);
              }
            }
            table = "</table>";
            $("#result").append(table);

            type = $("#problemType").val();
            if (type == "max") {
              var maxValue = 0;
              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) > maxValue) {
                    maxValue = data[i][j];
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  data[i][j] = maxValue - data[i][j];
                }
              }

              $("#result").append(
                "<br/><b>Conversión a un problema de Minimización :</b> <br/>El problema de maximización anterior se puede convertir a un problema de minimización equivalente restando todos los elementos de la matriz con respecto al elemento de coeficiente más alto, que en este caso es " +
                  maxValue +
                  ".<br/><br/>"
              );

              var table = '<table id="tableCon">';

              $("#result").append(table);
              for (var i = 0; i < block; i++) {
                table = '<tr id="rowCon' + i + '"></tr>';
                $("#result").append(table);
                for (var j = 0; j < block; j++) {
                  var printValue;
                  if (data[i][j] > 10000000) {
                    printValue = "M";
                    table = "<td>" + printValue + "</td>";
                  } else {
                    table = "<td>" + data[i][j] + "</td>";
                  }
                  $("#rowCon" + i).append(table);
                }
              }
              table = "</table>";
              $("#result").append(table);
              $("#result").append(
                "<br/><br/>Ahora, el problema anterior se puede resolver fácilmente mediante el método húngaro.<br/><br/>"
              );
            }

            var minRow = Array(block);
            var minCol = Array(block);

            minRow.fill(10000000);
            minCol.fill(10000000);

            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                var a = parseInt(minRow[i]);
                var b = parseInt(data[i][j]);
                if (a > b) {
                  minRow[i] = data[i][j];
                }
              }
            }

            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                data[i][j] = data[i][j] - minRow[i];
              }
            }

            $("#result").append(
              "<br/><br/><b>Paso 1 :</b><br/>Identificar el elemento mínimo en cada fila y restarlo de cada elemento de esa fila. El resultado se muestra en la siguiente tabla.<br/><br/>"
            );

            var table = '<table id="table3">';

            $("#result").append(table);
            for (var i = 0; i < block; i++) {
              table = '<tr id="row3' + i + '"></tr>';
              $("#result").append(table);
              for (var j = 0; j < block; j++) {
                var printValue;
                if (data[i][j] > 10000000) {
                  printValue = "M";
                  table = "<td>" + printValue + "</td>";
                } else {
                  table = "<td>" + data[i][j] + "</td>";
                }
                $("#row3" + i).append(table);
              }
            }
            table = "</table>";
            $("#result").append(table);

            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                var a = parseInt(minCol[i]);
                var b = parseInt(data[j][i]);
                if (a > b) {
                  minCol[i] = data[j][i];
                }
              }
            }

            for (var i = 0; i < block; i++) {
              for (var j = 0; j < block; j++) {
                data[j][i] = data[j][i] - minCol[i];
              }
            }

            $("#result").append(
              "<br/><br/><b>Paso 2 :</b><br/>Identificar el elemento de menor coeficiente en cada columna y restarlo de cada elemento de esa columna. El resultado se muestra en la siguiente tabla.<br/><br/>"
            );

            var table = '<table id="table4">';

            $("#result").append(table);
            for (var i = 0; i < block; i++) {
              table = '<tr id="row4' + i + '"></tr>';
              $("#result").append(table);
              for (var j = 0; j < block; j++) {
                var printValue;
                if (data[i][j] > 10000000) {
                  printValue = "M";
                  table = "<td>" + printValue + "</td>";
                } else {
                  table = "<td>" + data[i][j] + "</td>";
                }
                $("#row4" + i).append(table);
              }
            }
            table = "</table>";
            $("#result").append(table);

            $("#result").append(
              "<br/><br/><b>Paso 3 :</b><br/>Realizar las asignaciones para la matriz reducida obtenida de los pasos 1 y 2 de la siguiente manera:<br/><br/>a. Para cada fila o columna con una única celda de valor cero que no ha sido asignada o eliminada, marcar ese valor cero como una celda asignada.<br/><br/>b. Para cada cero que se asigna, tachar (X) todos los otros ceros en la misma fila y la misma columna.<br/><br/>c. Si para una fila y una columna, hay dos o más ceros y uno no puede ser elegido por inspección, elegir la celda arbitrariamente para la asignación.<br/><br/>d. El proceso anterior puede continuar hasta que cada celda de cero esté asignada o tachada (X).<br/><br/>"
            );

            $("#result").append(
              "<br/><br/><b>Paso 4 :</b><br/>Se encuentra una asignación óptima, si el número de celdas asignadas es igual al número de filas (y columnas). En caso de que se haya elegido una celda cero arbitrariamente, puede haber soluciones óptimas alternas o múltiples. Si no se encuentra una solución óptima, dirigirse al paso 5.<br/><br/>"
            );

            $("#result").append(
              "<br/><br/><b>Paso 5 :</b><br/>Trazar el mínimo número de líneas verticales y horizontales necesarias para cubrir todos los ceros en la matriz reducida obtenida del paso 3.<br/><br/>"
            );

            $("#result").append(
              "<br/><br/><b>Paso 6 :</b><br/>Seleccionar el elemento más pequeño de todos los elementos no cubiertos. Seguidamente, restar este elemento más pequeño de todos los elementos no cubiertos y agregarlo a los elementos que se encuentran en la intersección de dos líneas. Así, se obtiene otra matriz reducida para una nueva asignación.<br/><br/>"
            );

            $("#result").append(
              "<br/><br/><b>Paso 7 :</b><br/>Repetir el proceso desde el Paso 3 hasta el Paso 6 hasta que el total de asignaciones (N) sea igual al número de filas/columnas.<br/><br/>"
            );

            assignmentTable = new Array(block);
            for (var i = 0; i < block; i++) {
              assignmentTable[i] = new Array(block);
            }

            function calAssignmentTable() {
              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  assignmentTable[i][j] = 0;
                }
              }

              restrictPosition = new Array(block);
              for (var i = 0; i < block; i++) {
                restrictPosition[i] = new Array(block);
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  restrictPosition[i][j] = 0;
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) > 10000000) {
                    restrictPosition[i][j] = 1;
                  }
                }
              }

              cntZero = new Array(block);
              cntZeroCol = new Array(block);
              cntZero.fill(0);
              cntZeroCol.fill(0);

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    cntZero[i]++;
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[j][i]) == 0) {
                    cntZeroCol[i]++;
                  }
                }
              }

              var rowF = new Array(block);
              var colF = new Array(block);
              rowF.fill(0);
              colF.fill(0);

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      //alert(cntZero[i]);
                      if (parseInt(cntZero[i]) == 1) {
                        assignmentTable[i][j] = 1;
                        rowF[i] = -1;
                        colF[j] = -1;
                        cntZero[i] = 0;
                        cntZeroCol[j] = 0;
                        for (var k = i; k < block; k++) {
                          if (parseInt(data[k][j]) == 0) {
                            if (parseInt(cntZero[k]) != 0) {
                              cntZero[k]--;
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) == 2) {
                        if (parseInt(cntZeroCol[j]) == 1) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) == 2) {
                        if (parseInt(cntZeroCol[j]) == 2) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) == 2) {
                        if (parseInt(cntZeroCol[j]) >= 2) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) >= 2) {
                        if (parseInt(cntZeroCol[j]) == 1) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) >= 2) {
                        if (parseInt(cntZeroCol[j]) == 2) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(data[i][j]) == 0) {
                    if (parseInt(rowF[i]) == 0 && parseInt(colF[j]) == 0) {
                      if (parseInt(cntZero[i]) >= 2) {
                        if (parseInt(cntZeroCol[j]) >= 2) {
                          assignmentTable[i][j] = 1;
                          rowF[i] = -1;
                          colF[j] = -1;
                          cntZero[i] = 0;
                          cntZeroCol[j] = 0;
                          for (var k = 0; k < block; k++) {
                            if (parseInt(data[k][j] == 0)) {
                              if (parseInt(cntZero[k]) != 0) {
                                cntZero[k]--;
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }

              cntAlloc = 0;
              for (var i = 0; i < block; i++) {
                for (var j = 0; j < block; j++) {
                  if (parseInt(assignmentTable[i][j]) == 1) {
                    cntAlloc++;
                  }
                }
              }
            }

            calAssignmentTable();

            while (true) {
              if (cntAlloc == block) {
                $("#result").append(
                  "<br/><br/><b>Matriz de Asignación (Óptima) :</b><br/><br/>"
                );

                var table = '<table id="asiignmentTable">';

                $("#result").append(table);
                for (var i = 0; i < block; i++) {
                  table = '<tr id="rowA' + i + '"></tr>';
                  $("#result").append(table);
                  for (var j = 0; j < block; j++) {
                    if (parseInt(assignmentTable[i][j]) == 1) {
                      table =
                        "<td style='color: rgb(15, 255, 15); font-weight: bold;'>" +
                        originalData[i][j] +
                        "*" +
                        "</td>"; // Display the assignment value
                    } else {
                      table = "<td>" + originalData[i][j] + "</td>"; // Display the original value
                    }
                    $("#rowA" + i).append(table);
                  }
                }
                table = "</table>";
                $("#result").append(table);

                var ans = 0;
                var solutionValues = [];

                for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    if (parseInt(assignmentTable[i][j]) == 1) {
                      ans = ans + parseInt(originalData[i][j]);
                      solutionValues.push(originalData[i][j]);
                    }
                  }
                }

                $("#result").append("<br/><br/>");

                for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    if (parseInt(assignmentTable[i][j]) == 1) {
                      $("#result").append(
                        "X<sub>" +
                          (i + 1) +
                          (j + 1) +
                          "</sub> = " +
                          solutionValues[i] +
                          "  <br/>"
                      );
                    }
                  }
                }

                if (type == "max") {
                  $("#result").append(
                    "<br/><br/><label class='result' style='font-weight: bolder;'>Benefico (Máximo) : </label>" +
                      ans
                  );
                } else {
                  $("#result").append(
                    "<br/><br/><label class='result' style='font-weight: bolder;'>Costo (Mínimo) : </label>" +
                      ans
                  );
                }

                $("#doAnother").css("display", "inline-block");

                cntModified = 1;
                break;
              } else {
                var markedRows = new Array(block);
                var markedCols = new Array(block);

                markedRows.fill(-1);
                markedCols.fill(-1);

                outer: for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    if (parseInt(assignmentTable[i][j]) == 1) {
                      markedRows[i] = -1;
                      continue outer;
                    } else {
                      markedRows[i] = i;
                    }
                  }
                }

                for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    var x = parseInt(markedRows[i]);
                    if (x == -1) {
                    } else {
                      if (parseInt(data[x][j]) == 0) {
                        markedCols[j] = j;
                      }
                    }
                  }
                }

                for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    var x = parseInt(markedCols[i]);
                    if (x == -1) {
                    } else {
                      if (parseInt(assignmentTable[j][x]) == 1) {
                        markedRows[j] = j;
                      }
                    }
                  }
                }

                var coveredRows = new Array(block);
                var coveredCols = new Array(block);

                coveredRows.fill(0);
                coveredCols.fill(0);

                for (var i = 0; i < block; i++) {
                  if (parseInt(markedRows[i]) == -1) {
                    coveredRows[i] = 1;
                  }
                  if (parseInt(markedCols[i]) != -1) {
                    coveredCols[i] = 1;
                  }
                }

                var cntTable = 1;
                var smallUncover = 10000000;

                outer2: for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    if (
                      parseInt(coveredRows[i]) != 1 &&
                      parseInt(coveredCols[j]) != 1
                    ) {
                      if (smallUncover > data[i][j]) {
                        smallUncover = data[i][j];
                      }
                    }
                  }
                }

                for (var i = 0; i < block; i++) {
                  for (var j = 0; j < block; j++) {
                    if (
                      parseInt(coveredRows[i]) == 1 &&
                      parseInt(coveredCols[j]) == 1
                    ) {
                      //alert("in 1");
                      data[i][j] = data[i][j] + smallUncover;
                    } else if (
                      parseInt(coveredRows[i]) == 0 &&
                      parseInt(coveredCols[j]) == 0
                    ) {
                      //alert("in 2");
                      data[i][j] = data[i][j] - smallUncover;
                    }
                  }
                }

                calAssignmentTable();

                var id;
                id = "rowM" + cntModified;
                $("#result").append(
                  "<br/><br/><b>Modificación N° " +
                    cntModified +
                    " a la matriz original </b><br/><br/>"
                );

                var table = '<table id="modifiedTable' + cntModified + '">';

                $("#result").append(table);
                for (var i = 0; i < block; i++) {
                  table = '<tr id="' + id + i + '"></tr>';
                  $("#result").append(table);
                  for (var j = 0; j < block; j++) {
                    var printValue;
                    if (data[i][j] > 10000000) {
                      printValue = "M";
                      table = "<td>" + printValue + "</td>";
                    } else {
                      table = "<td>" + data[i][j] + "</td>";
                    }
                    $("#" + id + i).append(table);
                  }
                }
                table = "</table>";
                $("#result").append(table);

                cntModified++;
              }
            }
          });

          $("#anotherQue").click(function () {
            location.reload();
          });

          $("#printAns").click(function () {
            window.print();
          });
        });
      </script>
    </div>
  </body>
</html>
